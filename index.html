  <script src="https://apis.google.com/js/api.js"></script>

<body>
  <h2>click me until you see ("shataakk baby! copied" );
  </h2>
<script>
    
//MAIN API 
var YOUR_CLIENT_ID = '1096318296267-a3l9r898cd6uc95n64at2q06k31duh45.apps.googleusercontent.com';

  var YOUR_REDIRECT_URI = 'https://ss0809.github.io/Dark_Matter/';

  var  fileid2;
url = new URL(document.URL);
urlsp = url.searchParams;
if(urlsp.get("fileid")!=null)
  saveToLocalStorage('fileid',encodeURI(urlsp.get("fileid")));
 function saveToLocalStorage(key, value) {
    console.log('saved to storage');
  localStorage.setItem(key, JSON.stringify(value));
}
function getFromLocalStorage(key) {
  var value = localStorage.getItem(key);
  return JSON.parse(value);
  alert('retrieved')
}

  
  var x='ok', fragmentString = location.hash.substring(1);

  // Parse query string to see if page request is coming from OAuth 2.0 server.

  var params = {};

  var regex = /([^&=]+)=([^&]*)/g, m;

  while (m = regex.exec(fragmentString)) {

    params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);

  }

  if (Object.keys(params).length > 0) {

    localStorage.setItem('oauth2-test-params', JSON.stringify(params) );

    if (params['state'] && params['state'] == 'try_sample_request') {

    //  trySampleRequest();

    }

  }

  // If there's an access token, try an API request.

  // Otherwise, start OAuth 2.0 flow.

  function trySampleRequest(x1,t) {

    var params = JSON.parse(localStorage.getItem('oauth2-test-params'));

    if (params && params['access_token']) {
      

      var xhr = new XMLHttpRequest();

      xhr.open('POST',

          'https://www.googleapis.com/drive/v2/files/'+t+'/parents?' +

          'access_token=' + params['access_token']);

      xhr.onreadystatechange = function (e) {

        if (xhr.readyState === 4 && xhr.status === 200) {

          console.log(xhr.response);

        } else if (xhr.readyState === 4 && xhr.status === 401) {

          // Token invalid, so prompt for user permission.

          oauth2SignIn();

        }

      };

      var id ="id";

      var obj= {};

      obj[id] = x1;

      // place obj in stringify

      console.log(obj);

      xhr.send(JSON.stringify(obj));

      /*xhr.send(JSON.stringify(

        {

          "id": "1G6l5oasBfwZdc3jho60j5IM3iFW3hk-n"

        })

        );*/

    } else {

      oauth2SignIn();

    }
alert("shataakk baby! copied" );
  }

  

    function copyfile() {

    var params = JSON.parse(localStorage.getItem('oauth2-test-params'));

    if (params && params['access_token']) {

      var xhr = new XMLHttpRequest();

      xhr.open('POST',

          'https://www.googleapis.com/drive/v3/files/'+getFromLocalStorage('fileid')+'/copy?' +

          'access_token=' + params['access_token']);

      xhr.onreadystatechange = function (e) {

        if (xhr.readyState === 4 && xhr.status === 200) {

          var myObj2 = JSON.parse(xhr.response);

console.log(xhr.response+"copy");

 fileid2 = myObj2.id;

 createfolder(fileid2);

        } else if (xhr.readyState === 4 && xhr.status === 401) {

          // Token invalid, so prompt for user permission.

          oauth2SignIn();

        }

      };

    

      xhr.send(null);

    } else {

      oauth2SignIn();

    }

  }

  

  function createfolder(t) {

    var params = JSON.parse(localStorage.getItem('oauth2-test-params'));

    if (params && params['access_token']) {

      var xhr = new XMLHttpRequest();

      xhr.open('POST',

          'https://www.googleapis.com/drive/v3/files?' +

          'access_token=' + params['access_token']);

      xhr.onreadystatechange = function (e) {

        if (xhr.readyState === 4 && xhr.status === 200) {

          var myObj = JSON.parse(xhr.response);

console.log(xhr.response+"fold");

 x = myObj.id;

 trySampleRequest(x,t);

        } else if (xhr.readyState === 4 && xhr.status === 401) {

          // Token invalid, so prompt for user permission.

          oauth2SignIn();

        }

      };

   

      xhr.send(JSON.stringify(

{

  "name": "created",

  "mimeType": "application/vnd.google-apps.folder"

}));

    } else {

      oauth2SignIn();

    }

  }

  /*

   * Create form to request access token from Google's OAuth 2.0 server.

   */

  function oauth2SignIn() {

    // Google's OAuth 2.0 endpoint for requesting an access token

    var oauth2Endpoint = 'https://accounts.google.com/o/oauth2/v2/auth';

    // Create element to open OAuth 2.0 endpoint in new window.

    var form = document.createElement('form');

    form.setAttribute('method', 'GET'); // Send as a GET request.

    form.setAttribute('action', oauth2Endpoint);

    // Parameters to pass to OAuth 2.0 endpoint.

    var params = {'client_id': '1096318296267-a3l9r898cd6uc95n64at2q06k31duh45.apps.googleusercontent.com',

                  'redirect_uri':'https://ss0809.github.io/Dark_Matter/',

                  'scope': 'https://www.googleapis.com/auth/drive',

                  'state': 'try_sample_request',

                  'include_granted_scopes': 'true',

                  'response_type': 'token'};

    // Add form parameters as hidden input values.

    for (var p in params) {

      var input = document.createElement('input');

      input.setAttribute('type', 'hidden');

      input.setAttribute('name', p);

      input.setAttribute('value', params[p]);

      form.appendChild(input);

    }

    // Add form to page and submit it to open the OAuth 2.0 endpoint.

    document.body.appendChild(form);

    form.submit();

  }
</script>

<button onclick="copyfile();">Save fike from shared drive to my drive in created folder</button>

</body></html>